<!DOCTYPE html>
<html> 

<head>
  <meta charset="utf-8" />
  <meta name="description" content="Wyatt Stanley" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

  <title>Wyatt Stanley</title>
  <!-- <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,400;0,500;1,400;1,500&display=swap" /> -->
  <!-- <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css"> -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"> -->
  <link rel="stylesheet" href="map.css">
  <script src="https://unpkg.com/scrollama"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
</head>

<body>

    <div class="topnav" id="myTopnav">

        <a href="index.html">Home</a>
        <a href="pipe.html">Pipelines</a>
        <a href="train.html">Train</a>
        <a class="active" href="water.html">Vessel</a>


        <!-- "Hamburger menu" / "Bar icon" to toggle the navigation links on smaller screens -->
        <a href="javascript:void(0);" class="icon">
            <i class="fa fa-bars"></i>
        </a>
    </div>

  <!-- loading a video cover page -->
  <section id="cover">
    <!-- loading a video as the background -->

    <style>
        .fullscreen-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
    
    <video class="fullscreen-video" playsinline="" autoplay="" muted="" loop="">
      <source src="video/boat2.mp4" type="video/mp4">
    </video>


    <div id="intro">
      <h1>Washington Fossil Fuel Spill Risk</h1>
      <h5>Vessel</h5>
      <p>Chinook salmon, a once plentiful species in the Pacific Northwest, occupied the Puget Sound and Columbia River (Hanson, 2021). 
        Since the 1970’s, these salmon populations of the Northeastern Pacific have experienced a decline in abundance and productivity. 
        (Couture, 2022). Many factors aid to this decline, including global warming, which has heated British Columbias Fraser River ~1.8 
        degrees F from 1953 to 1998, killing 50% of that river’s sockeye salmon (Olsen, 2022).</p>

      <div class="footnote">
        <span><a href="https://stock.adobe.com">Video Source</a></span>
      </div>
    </div>
  </section>
  <!-- a geonarrative will have two major components, a storyboard and a script panel of a series of scenes/actions -->
  <section id="geonarrative">
    <!-- a storymap can present differnt types of objects, like map, chart, diagram, etc. -->
    <div id="storyboard">
      <!-- create the place holder element for map -->
      <div id="map"></div>
    </div>

    <article class="scene" data-scene="0">
      <h2>1: Refinaries</h2>
        <p>

        </p>
        <img class="img" src="img/orcaphoto.jpg" style="width: 50%; height: auto; display: block; margin: 0 auto; box-shadow: 0px 4px 8px rgba(0, 0, 0, 1);"></img>
        <p><a href="https://unsplash.com">Photo Source</a> <a href="https://geo.wa.gov/datasets/34764715c1254a639b831f3c9de92417_3/explore?location=48.017796%2C-122.718350%2C8.67">Data Source</a></p>
    </article>
    <article class="scene" data-scene="1">
      <h2>2: Ports</h2>
            <p>

            <!-- <img class="img" src="img/trash.jpeg" style="width: 50%; height: auto; display: block; margin: 0 auto; box-shadow: 0px 4px 8px rgba(0, 0, 0, 1);"></img>
            <p><a href="https://unsplash.com">Photo Source</a> <a href="https://geo.wa.gov/datasets/34764715c1254a639b831f3c9de92417_3/explore?location=48.017796%2C-122.718350%2C8.67">Data Source</a></p> -->
            <p>
    </article>
    <article class="scene" data-scene="2">
      <h2>3: 2020 Vessel Routes </h2>
        <p>

        </p>
        
    </article>

    <article class="scene" data-scene="3">
      <h2>4: Tug Boats  </h2>
        <p>

        <p>
    </article>

    <article class="scene" data-scene="4">
      <h2>4: Spills  </h2>
        <p>

        <p>
    </article>

    <article class="scene" data-scene="5">
      <h2>4: Response Plans  </h2>
        <p>

        <p>
    </article>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>

  </section>

  <section id="footer">
    <h2>Wyatt Stanley</h2>
  </section>

  <script>
    // 1. Declare the maps, script panels, and different thematic layers.
    let map, scriptPanel = scrollama(), portsLayer, ports2Layer, refineLayer, trafficLayer, tugLayer, vspillLayer, respondLayer, incomeLayer;

    // 2. Intialize the layout.
   
    history.scrollRestoration = "manual"; // make sure the geo-narrative will be scrolled to the cover page even after a page refresh.
    window.scrollTo(0, 0); // scroll the geo-narrative to the coverpage
    adjustStoryboardlSize(); // force a browser window resize.
    window.addEventListener("resize", adjustStoryboardlSize); // // ask the browser window listen to the resize event, thereby force a viewport resize whenever adjusting the window size.

    // 3. Define Generic window resize listener event
    function adjustStoryboardlSize() {

      const scenes = document.getElementsByClassName("scene");
      const storyboard = document.getElementById("storyboard");

      // 3.1 determine the height of each scene element
      let sceneH = Math.floor(window.innerHeight * 0.75);
      for (const scene of scenes) {
        scene.style.height = sceneH + "px";
      }
      
      // 3.2 determin the height of the storyboard.
      let storyboardHeight = window.innerHeight;
      let storyboardMarginTop = (window.innerHeight - storyboardHeight) / 2;

      storyboard.style.height = storyboardHeight + "px";
      storyboard.style.top = storyboardMarginTop + "px"

      // 3.3 tell scrollama/script panel to update new element dimensions
      scriptPanel.resize();
    }

    // 4. Initialize the mapbox
    mapboxgl.accessToken =
      'pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw'; // Assign the access token
   
    map = new mapboxgl.Map({
      container: 'map', // container ID
      style: 'mapbox://styles/mapbox/light-v10',
      zoom: 7, // starting zoom
      minZoom: 3,
      maxZoom: 10,
      center: [-121.93, 47.33], // starting center
      scrollZoom: false,
      boxZoom: false,
      doubleClickZoom: false
    });  // Declare the map object

    // An alternative way to disable map zoom when using scroll
    // map.scrollZoom.disable();


    // 5. define the asynchronous function to load geojson data and then performs the dependent actions.
    async function geojsonFetch() {


      // 6 wait till the data of washington counties and celltowers are fully loaded.
      let response, ports, ports2, refine, traffic, tug, vspill, respond, income;
      response = await fetch("assets/Water/Ports.geojson");
      ports = await response.json();
      response = await fetch("assets/Water/Ports2.geojson");
      ports2 = await response.json();
      response = await fetch("assets/Water/refinaries.geojson");
      refine = await response.json();
      response = await fetch("assets/Water/traffic.geojson");
      traffic = await response.json();
      response = await fetch("assets/Water/tug.geojson");
      tug = await response.json();
      response = await fetch("assets/Water/VesselSpills.geojson");
      vspill = await response.json();
      response = await fetch("assets/Water/response.geojson");
      respond = await response.json();
      response = await fetch("assets/Water/lowincome.geojson");
      income = await response.json();




      // 7. Trigger operations inside of the the ()=> {} funciton while loading the map.
      map.on('load', () => {

        // 8. add map source and declare layers.
        map.addSource('ports-src', {
          type: 'geojson',
          data: ports
        });

        map.addSource('ports2-src', {
          type: 'geojson',
          data: ports2
        });

        map.addSource('refine-src', {
          type: 'geojson',
          data: refine
        });

        map.addSource('traffic-src', {
          type: 'geojson',
          data: traffic
        });

        map.addSource('tug-src', {
          type: 'geojson',
          data: tug
        });

        map.addSource('vspill-src', {
          type: 'geojson',
          data: vspill
        });

        map.addSource('respond-src', {
          type: 'geojson',
          data: respond
        });

        map.addSource('income-src', {
          type: 'geojson',
          data: income
        });





        //declare layers

        portsLayer = {
          'id': 'ports-points',
          'type': 'circle',
          'source': 'ports-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 7,
            'circle-opacity': 0.7,
            
          }
        };

        ports2Layer = {
          'id': 'ports2-points',
          'type': 'circle',
          'source': 'ports2-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 7,
            'circle-opacity': 0.7,
            
          }
        };

        refineLayer = {
          'id': 'refine-points',
          'type': 'circle',
          'source': 'refine-src',
          'minzoom': 1,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 5,
            'circle-opacity': 0.4,
          }
        };


        trafficLayer = {
          'id': 'traffic-polygons',
          'type': 'fill',
          'source': 'traffic-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#cc0000',
            'fill-opacity': 0.2

          }
        };

        tugLayer = {
          'id': 'tug-points',
          'type': 'circle',
          'source': 'tug-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#00cc00',
            'circle-radius': 5,
            'circle-opacity': 0.4,
          }
        };

        vspillLayer = {
          'id': 'vspill-points',
          'type': 'circle',
          'source': 'vspill-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 7,
            'circle-opacity': 0.5,
          }
        };

        respondLayer = {
          'id': 'respond-points',
          'type': 'circle',
          'source': 'respond-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#00cc00',
            'circle-radius': 3,
            'circle-opacity': 0.4,
          }
        };

        incomeLayer = {
          'id': 'income-polygons',
          'type': 'fill',
          'source': 'income-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#cc0000',
            'fill-opacity': 0.2

          }
        };



        // 9. Initialize the script panel
        scriptPanel
          .setup({
            step: ".scene", // all the scenes.
            offset: 0.33, // the location of the enter and exit trigger
            debug: false // toggler on or off the debug mode.
          })
          .onStepEnter(handleSceneEnter)
          .onStepExit(handleSceneExit);
        
        // 10. This function performs when a scene enters the storyboard
        function handleSceneEnter(response) {

          var index = response.index; // capture the id of the current scene. 

          // Refinaries
          
          if (index === 0) { // When enter the first scene

            map.flyTo({
              center: [-124.6, 47.6131229],
              zoom: 6.2,
              pitch: 0,
              speed: 0.5
            }); // fly to a new location
            
            if (typeof (map.getSource('refine-src')) == 'undefined') { //if the map source 'counties-src' does not exist
              map.addSource('refine-src', {
                type: 'geojson',
                data: refine
              }); // reload the map source of 'counties-src'
            } else {
              map.getSource('refine-src').setData(refine); // if the map source does not exist, relaod the data counties to the pre-defined map source 'counties-src'.

            }

            if (!map.getLayer("refine-points")) { // if the map layer 'counties-polygons' does not exit
              map.addLayer(refineLayer);
            }
            document.getElementById("cover").style.visibility = "hidden"; // Hide the cover page
        

            // Ports
          } else if (index === 1) { // When enter the second scene.
            map.flyTo({
              center: [-124, 47],
              zoom: 8,
              pitch: 50,
              speed: 0.5
            });

            if (typeof (map.getSource('ports-src')) == 'undefined') {
              map.addSource('ports-src', {
                type: 'geojson',
                data: ports
              });
            } else {
              map.getSource('ports-src').setData(ports);

            }

            if (!map.getLayer("ports-points")) {
              map.addLayer(portsLayer);
            }

            if (typeof (map.getSource('income-src')) == 'undefined') {
              map.addSource('income-src', {
                type: 'geojson',
                data: income
              });
              

            } else {
              map.getSource('income-src').setData(income);

            }

            if (!map.getLayer("income-polygons")) {
              map.addLayer(incomeLayer);
            }
            
          } else if (index === 2) {
            //Relocate to Seattle
            map.flyTo({
              center: [-124.8, 48.3],
              zoom: 7.5,
              pitch: 10,
              speed: 0.5

            });

            if (typeof (map.getSource('ports2-src')) == 'undefined') {
              map.addSource('ports2-src', {
                type: 'geojson',
                data: ports2
              });
            } else {
              map.getSource('ports2-src').setData(ports2);

            }

            if (!map.getLayer("ports2-points")) {
              map.addLayer(ports2Layer);
            }
            document.getElementById("cover").style.visibility = "hidden"; // Hide the cover page

            if (typeof (map.getSource('traffic-src')) == 'undefined') {
              map.addSource('traffic-src', {
                type: 'geojson',
                data: traffic
              });
              

            } else {
              map.getSource('traffic-src').setData(traffic);

            }

            if (!map.getLayer("traffic-polygons")) {
              map.addLayer(trafficLayer);
            }
            document.getElementById("cover").style.visibility = "hidden"; // Hide the cover page

          } else if (index === 3) {
            map.flyTo({
              center: [-126, 48.3],
              zoom: 7.5,
              pitch: 10,
              speed: 0.5

            });

            if (typeof (map.getSource('tug-src')) == 'undefined') {
              map.addSource('tug-src', {
                type: 'geojson',
                data: tug
              });
            } else {
              map.getSource('tug-src').setData(tug);

            }

            if (!map.getLayer("tug-points")) {
              map.addLayer(tugLayer);
            }
            document.getElementById("cover").style.visibility = "hidden"; // Hide the cover page

          } else if (index === 4) {
            map.flyTo({
              center: [-122.75, 48.5],
              zoom: 10,
              pitch: 0,
              speed: 0.5

            });

            if (typeof (map.getSource('vspill-src')) == 'undefined') {
              map.addSource('vspill-src', {
                type: 'geojson',
                data: vspill
              });
            } else {
              map.getSource('vspill-src').setData(vspill);

            }

            if (!map.getLayer("vspill-points")) {
              map.addLayer(vspillLayer);
            }
            document.getElementById("cover").style.visibility = "hidden"; // Hide the cover page

          } else if (index === 5) {
            map.flyTo({
              center: [-124, 47],
              zoom: 8,
              pitch: 50,
              speed: 0.5

            });

            if (typeof (map.getSource('respond-src')) == 'undefined') {
              map.addSource('respond-src', {
                type: 'geojson',
                data: respond
              });
            } else {
              map.getSource('respond-src').setData(respond);

            }

            if (!map.getLayer("respond-points")) {
              map.addLayer(respondLayer);
            }
            document.getElementById("cover").style.visibility = "hidden"; // Hide the cover page

          }else if (index === 8) {

            map.flyTo({
              center: [-122.4121036, 47.6131229],
              zoom: 7,
              pitch: 0,
              speed: 0.5

            });


          }



        }

        

        // 11. This function performs when a scene exists the storyboard
        function handleSceneExit(response) {
          var index = response.index;

          if (index === 0) {
            if (map.getLayer("refine-points")) {
              map.removeLayer('refine-points');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 1) {
            if (map.getLayer("ports-points")) {
              map.removeLayer('ports-points');
            }
            if (map.getLayer("income-polygons")) {
              map.removeLayer('income-polygons');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 2) {
            if (map.getLayer("traffic-polygons")) {
              map.removeLayer('traffic-polygons');
            }
            if (map.getLayer("ports2-points")) {
              map.removeLayer('ports2-points');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 3) {
            if (map.getLayer("tug-points")) {
              map.removeLayer('tug-points');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 4) {
            if (map.getLayer("vspill-points")) {
              map.removeLayer('vspill-points');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 5) {
            if (map.getLayer("respond-points")) {
              map.removeLayer('respond-points');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          }
        
        }
        });

    };
    // Define a popup variable for tribal and wetland data
    
    let refinePopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });
    
    let vspillPopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    let portsPopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    let ports2Popup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    let trafficPopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    let full_tribalPopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    

    // SPILLS
    map.on('click', 'vspill-points', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>${feature.properties.CaseName}</h3>
                          <p>Date: ${feature.properties.Date_incid}</p>
                          <p>Vessel Type: ${feature.properties.Source}</p>
                          <p>Oil Type: ${feature.properties.Oil_type}</p>`;
      vspillPopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'vspill-points', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'vspill-points', function() {
      map.getCanvas().style.cursor = '';
    });

    // REFINARIES
    map.on('click', 'refine-points', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>${feature.properties.FacilityNa}</h3>
                          <p>Oil Type: ${feature.properties.OilProduct}</p>`;
      refinePopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'refine-points', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'refine-points', function() {
      map.getCanvas().style.cursor = '';
    });


    // Ports
    map.on('click', 'ports-points', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>${feature.properties.NAME}</h3>
                          <p>Oil Type: ${feature.properties.TYPE}</p>`;
      portsPopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'ports-points', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'ports-points', function() {
      map.getCanvas().style.cursor = '';
    });

    map.on('click', 'ports2-points', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>${feature.properties.NAME}</h3>
                          <p>Oil Type: ${feature.properties.TYPE}</p>`;
      ports2Popup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'ports2-points', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'ports2-points', function() {
      map.getCanvas().style.cursor = '';
    });


    // Traffic
    map.on('click', 'traffic-polygons', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>2020 Vessel Traffic</h3>`;

      trafficPopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'traffic-polygons', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'traffic-polygons', function() {
      map.getCanvas().style.cursor = '';
    });





    const nav = new mapboxgl.NavigationControl();
    map.addControl(nav, 'top-right');





    // 5 call the data loading function.
    geojsonFetch();
  </script>
</body>

</html>

  