<!DOCTYPE html>
<html> 

<head>
  <meta charset="utf-8" />
  <meta name="description" content="Wyatt Stanley" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

  <title>Wyatt Stanley</title>
  <!-- <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,400;0,500;1,400;1,500&display=swap" /> -->
  <!-- <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css"> -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"> -->
  <link rel="stylesheet" href="map.css">
  <script src="https://unpkg.com/scrollama"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
</head>


<body>

    <div class="topnav" id="myTopnav">

        <!-- Links to other sections -->
        <a href="index.html">Home</a>
        <a class="active" href="pipe.html">Pipelines</a>
        <a href="Train2.html">Trains</a>
        <a href="water.html">Vessels</a>


        <!-- Additional links -->


        <!-- "Hamburger menu" / "Bar icon" to toggle the navigation links on smaller screens -->
        <a href="javascript:void(0);" class="icon">
            <i class="fa fa-bars"></i>
        </a>
    </div>

  <section id="cover">

    <style>
        .fullscreen-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
    
    <video class="fullscreen-video" playsinline="" autoplay="" muted="" loop="">
      <source src="video/Pipe.mp4" type="video/mp4">
    </video>

    <div id="intro">
      <h1>Pipelines</h1>
      <h5>Washington Fossil Fuel Spill Risk</h5>

      <div class="footnote">
        <!-- <span><a href="https://stock.adobe.com">Video Source</a></span> -->
      </div>
    </div>
  </section>
  <!-- a geonarrative will have two major components, a storyboard and a script panel of a series of scenes/actions -->
  <section id="geonarrative">
    <!-- a storymap can present differnt types of objects, like map, chart, diagram, etc. -->
    <div id="storyboard">
      <!-- create the place holder element for map -->
      <div id="map"></div>
    </div>

    <article class="scene" data-scene="0">
      <h2>1: Refinaries</h2>
        <p>
          This map displays Washington facilities that are regulated by the Washington State Department of Ecology's Spills Program. 
          These points represent fixed shore-side facilities such as refineries and refueling terminals. This includes facilities that 
          transfer to or from tank vessels and pipelines. These facilities refine products such as Gas, Diesel, Crude Oil, Motor Oil, 
          Edible Oils, and more.
          <a href="https://apps.ecology.wa.gov/coastalatlas/storymaps/spills/spills_sm.html?&Tab=nt1">Refinary Data.</a>
          <br>
          <br>
          These points include refineries that are used by Washington's largest oil pipelines, which include the Olympic pipeline, 
          the Trans Mountain pipeline, the Yellowstone and Chevron pipeline, and the Northwest pipeline. These pipelines carry millions 
          of gallons of crude oils, natural gas, and refined products thousands of miles across Washington State. In the case of the 
          Northwest pipeline, pipe circumference and compressors are being updated to transport more oil across states such as 
          Washington, Oregon, and California, which don't support the continuation or investment in the oil industry.
          <br>
          <br>
          The maps below will go into more detail on how these pipelines affect the communities and environments of Washington State.


          

        </p>
        
    </article>
    <article class="scene" data-scene="1">
      <h2>2: Olympic Pipeline</h2>
        <p>
          "The Olympic Pipeline is a 400-mile interstate pipeline system that includes 12-inch, 14-inch, 16-inch, and 20-inch pipelines. 
          The pipeline runs along a 299-mile corridor from Blaine, Washington to Portland, Oregon. The system transports gasoline, 
          diesel, and jet fuel" <a href="https://www.bp.com/en_us/united-states/home/products-and-services/pipelines.html">(BP)</a>
          <br>
          <br>
          This map displays the Olympic pipeline along with the Refinaries it is conncected to. Click on the points to learn more about these
          <a href="https://apps.ecology.wa.gov/coastalatlas/storymaps/spills/spills_sm.html?&Tab=nt1">refinaries.</a> The Olympic pipline image is based on a map found 
          <a href="https://www.bp.com/content/dam/bp/country-sites/en_us/united-states/home/documents/products-and-services/pipelines/olympic-overview.pdf">here.</a>

        </p>
    </article>
    <article class="scene" data-scene="2">
      <h2>3: Olympic Wetlands</h2>
        <p>
          Wetlands are a vital environmental asset to Washington State. "Wetlands are among the most productive ecosystem in the 
          world, comparable to rain forests and coral reefs. An immense variety of species of microbes, plants, insects, amphilbians, 
          retiles, birds, fish, and mammels can be part of a wetland system" <a href="https://www.epa.gov/wetlands/why-are-wetlands-important">EPA</a>
          <br>
          <br>
          Areas running along train tracks have a half mile evacuation zone in the case of a train crash. Wetlands can be damaged through
           toxid fumes, smoke, and oil fires up to a mile from a train track in the event of an oil spill <a href="https://www.biologicaldiversity.org/campaigns/oil_trains/methodology.html">(BiologicalDiversity)</a>.
           Due to the fact that there is less risk of fire involved in a pipeline burst, I limited the wetland buffer to a half mile.
           
          <br>
          <br>
          <a href="https://geo.wa.gov/datasets/02b250843e44485ea7d736b34fa80998_4/explore?location=47.630334%2C-120.819730%2C12.31">Wetlands Data.</a>
          This map displays the Olympic pipeline running south from Bellingham to Vancover Washington and all the wetlands within a half mile on either side of the track.
           In this area, there are 1,671 wetland areas encompassing 21,761 square miles of land. 
        </p>
        
    </article>

    <article class="scene" data-scene="3">
      <h2>4: Environmental Justice Areas</h2>
        <p>
          "Low-income households and communities of color are more likely than more affluent and white communities to live in proximity 
          to polluting industries like oil refineries and pipeline infrastructure, leading to disproportionate exposure to pollution from 
          burning fossil fuels and chemicals leaching into the water table. And because of often discriminatory policies and poor city 
          planning, these same communities are hit first and worst by climate-exacerbated events like extreme drought, major floods, 
          wildfires, and urban heat islands" <a href="https://www.climaterealityproject.org/blog/how-pipelines-fuel-climate-injustice#:~:text=According%20to%20the%20Southern%20Environmental,or%20belonging%20to%20racial%20or">(The Climate Reality Project)</a>
          <br>
          <br>
          This map displays all the census tracts in Washington where more than 51% of the population is considered low income. 
        </p>
    </article>
    <article class="scene" data-scene="4">
      <h2>5: Olympic Tribal Lands</h2>
      <p>
        This map displays tribal land proximity to refinaries. Both tribal lands found here, Lummi and Swinomish, have experienced the effects of
        oil spills by train and vessel. More details can be found in on the Vessels and Train pages.
        <a href="https://www.arcgis.com/apps/View/index.html?appid=359a365f28014151a1ce821dd6f6745c">Tribal Lands:</a>
      </p>
    </article>

    <article class="scene" data-scene="5">
      <h2>6: TransMountain Pipeline</h2>
      <p>
        "At the Sumas delivery point in Abbotsford, BC, the Trans Mountain Pipeline connects with the Trans Mountain Puget Sound 
        Pipeline, a system that has been shipping Canadian crude oil products since 1954 to Washington state refineries in Anacortes, 
        Cherry Point and Ferndale for processing" <a href="https://www.transmountain.com/news/2019/trans-mountains-puget-sound-pipeline-shipping-products-to-washington-state-refineries-since-1954">(TransMountain).</a>
        <br>
        <br>
        "The Trans Mountain Puget Sound Pipeline is a 111-kilometre (69-mile) pipeline system made up of 16- to 20-inch pipe and has 
        the capacity for up to about 240,000 bpd (28,600 m3 per day) depending on petroleum types transported and the balance of 
        deliveries between the two destinations – Anacortes and Ferndale" <a href="https://www.transmountain.com/news/2019/trans-mountains-puget-sound-pipeline-shipping-products-to-washington-state-refineries-since-1954">(TransMountain).</a>
        <a href="https://atlas.eia.gov/datasets/eia::crude-oil-pipelines/explore?location=47.376601%2C-120.396332%2C7.00">TransMountain</a>
        <a href="https://www.transmountain.com/product-destination">Connection Info</a>
      </p>

    </article>

    <article class="scene" data-scene="6">
      <h2>7: Trans Mountain Wetlands</h2>

      <p>
        The Trans Mountain pipeline running into Bellingham Washington from Canada is within a half mile radius of 502 wetland areas encompassing 
        3,607 square miles of wetland area.
        <br>
        <br>
        <a href="https://geo.wa.gov/datasets/02b250843e44485ea7d736b34fa80998_4/explore?location=47.630334%2C-120.819730%2C12.31">wetland data.</a>
      </p>

      


    </article>

    <article class="scene" data-scene="7">
      <h2>8: Trains Mountain Income</h2>
      <p>
        This map displays low income areas that may be effected my the Trans Mountain refinariy spills or pollution.
        <a href="https://hudgis-hud.opendata.arcgis.com/datasets/HUD::low-to-moderate-income-population-by-tract/explore?location=35.163572%2C58.263972%2C3.82">Income Data</a>
      </p>

      


    </article>


    <article class="scene" data-scene="8">
      <h2>9: Yellowstone & Chevron Pipeline</h2>
      <p>

        <a href="https://www.researchgate.net/figure/3-WA-Department-of-Ecology-Marine-and-Pipeline-Routes-in-Puget-Sound-Region-Credit_fig1_268810713">Based On</a>
      </p>

      


    </article>

    <article class="scene" data-scene="9">
      <h2>10: Yellowstone & Chevron Pipeline Wetlands</h2>
      <p>
        Combined, the Yellowstone & Chevron Pipelines in Eastern Washington are within a one mile radius of 598 wetland areas encompassing 
        5,820 square miles of wetland area.
        <br>
        <br>
        <a href="https://geo.wa.gov/datasets/02b250843e44485ea7d736b34fa80998_4/explore?location=47.630334%2C-120.819730%2C12.31">Wetlands.</a>
      </p>

      


    </article>

    <article class="scene" data-scene="10">
      <h2>11: yesllowstone Income</h2>
      <p>
        This map shows the low income areas that may be effected by oil spills or pollution. Notice how all the refinaries are located within 
        or surrounding a low income census tract.
        <a href="https://hudgis-hud.opendata.arcgis.com/datasets/HUD::low-to-moderate-income-population-by-tract/explore?location=35.163572%2C58.263972%2C3.82">Income Data</a>
      </p>

      


    </article>

    <article class="scene" data-scene="11">
      <h2>12: Northwest Pipeline</h2>
      <p>
        On October 19th, 2023, the Federal Energy Regulatory Commission (FERC) allowed the proposed gas transmission northwest pipeline 
        to move forward with its expansion. This expansion will “…upgrade three existing compressor stations on the Gas Transmission 
        Northwest (GTN) system - transporting natural gas since 1962 - to meet increasing demand from residential, commercial and 
        industrial customers in the Pacific Northwest…” (TC Energy). The expansion of this project will allow for the pipeline to 
        transport 150,000 dekatherms of natural gas a day, enough gas to power 750,000 homes. This pipeline is expected to continue 
        at this rate for 50 years after its completion (Washington Governor Jay Inslee).
        <br>
        <br>
        TC Energy, the company leading this project claims that this 1,377-mile pipeline system will be able to transport Canadian 
        natural gas to communities in Washington, Oregon, and California and has the capacity to deliver as much as 2.7 billion cubic 
        feet per day. (TC Energy).
        <br>
        <br>
        Gov. Jay Inslee addressed the pipeline expansion on October 19th, 2023 stating “This decision also runs contrary to Washington s
        tate laws that require our utilities to transition to 100% clean energy by 2045…” and that “Expanding this fossil fuel pipeline 
        for 50 years - until 2073 - saddles our children and their children with climate harm and fossil fuel costs.” 
        (Washington Governor Jay Inslee)


        <a href="https://www.tcenergy.com/siteassets/pdfs/natural-gas/gas-transmission-northwest/tc-gas-transmission-northwest-map.pdf">NW Pipeline Based On</a>
        <a href="https://tcenergy.com/siteassets/pdfs/natural-gas/gtnxp/tce-gas-transmission-northwest-xpress-map.pdf">Commpressors Based On</a>
      </p>


      


    </article>

    <article class="scene" data-scene="12">
      <h2>13: Northwest Wetlands</h2>
      <p>
        The NorthWest Pipeline, running from Spokane south through Eastern Washington, is within a half mile radius of 89 wetland areas 
        encompassing ~1,176 square miles of wetland area.
      </p>

      


    </article>

    <article class="scene" data-scene="13">
      <h2>14: Northwest Pipeline</h2>
      <p>
      </p>

      


    </article>







    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>


  </section>

  <section id="footer">
    <h2>Wyatt Stanley</h2>
  </section>
  
  <script>
    // 1. Declare the maps, script panels, and different thematic layers.
    let map, scriptPanel = scrollama(), refineLayer, rolympicLayer, olympic2Layer, ysLayer, ys2Layer, tmLayer, tm2Layer, nwLayer, nw2Layer, owetLayer, yswetLayer, tmwetLayer, nwwetLayer, orfLayer, orf2Layer, ysrfLayer, tmrf2Layer, nwrfLayer, income, o_tribeLayer;

    // 2. Intialize the layout.
   
    history.scrollRestoration = "manual"; // make sure the geo-narrative will be scrolled to the cover page even after a page refresh.
    window.scrollTo(0, 0); // scroll the geo-narrative to the coverpage
    adjustStoryboardlSize(); // force a browser window resize.
    window.addEventListener("resize", adjustStoryboardlSize); // // ask the browser window listen to the resize event, thereby force a viewport resize whenever adjusting the window size.

    // 3. Define Generic window resize listener event
    function adjustStoryboardlSize() {

      const scenes = document.getElementsByClassName("scene");
      const storyboard = document.getElementById("storyboard");

      // 3.1 determine the height of each scene element
      let sceneH = Math.floor(window.innerHeight * 0.75);
      for (const scene of scenes) {
        scene.style.height = sceneH + "px";
      }
      
      // 3.2 determin the height of the storyboard.
      let storyboardHeight = window.innerHeight;
      let storyboardMarginTop = (window.innerHeight - storyboardHeight) / 2;

      storyboard.style.height = storyboardHeight + "px";
      storyboard.style.top = storyboardMarginTop + "px"

      // 3.3 tell scrollama/script panel to update new element dimensions
      scriptPanel.resize();
    }

    // 4. Initialize the mapbox
    mapboxgl.accessToken =
      'pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw'; // Assign the access token
   
    map = new mapboxgl.Map({
      container: 'map', // container ID
      style: 'mapbox://styles/mapbox/light-v10',
      zoom: 7, // starting zoom
      minZoom: 3,
      maxZoom: 10,
      center: [-121.93, 47.33], // starting center
      scrollZoom: false,
      boxZoom: false,
      doubleClickZoom: false
    });  // Declare the map object

    // An alternative way to disable map zoom when using scroll
    // map.scrollZoom.disable();


    // 5. define the asynchronous function to load geojson data and then performs the dependent actions.
    async function geojsonFetch() {


      // 6 wait till the data of washington counties and celltowers are fully loaded.
      let response, refine, olympic, olympic2, ys, ys2, tm, tm2, nw, nw2, owet, yswet, tmwet, nwwet, orf, orf2, ysrf, tmrf, tmrf2, nwrf, income, o_tribe;
      
      // ALL REFINARIES
      response = await fetch("assets/Water/refinaries.geojson");
      refine = await response.json();

      // PIPELINES

      response = await fetch("assets/Pipe/Olympic.geojson");
      olympic = await response.json();
      response = await fetch("assets/Pipe/Olympic.geojson");
      olympic2 = await response.json();
      response = await fetch("assets/Pipe/YS_pipeline.geojson");
      ys = await response.json();
      response = await fetch("assets/Pipe/YS_pipeline.geojson");
      ys2 = await response.json();
      response = await fetch("assets/Pipe/TM_pipeline.geojson");
      tm = await response.json();
      response = await fetch("assets/Pipe/TM_pipeline.geojson");
      tm2 = await response.json();
      response = await fetch("assets/Pipe/NW_Pipeline.geojson");
      nw = await response.json();
      response = await fetch("assets/Pipe/NW_Pipeline.geojson");
      nw2 = await response.json();

      // // WETLANDS
      response = await fetch("assets/Pipe/oly_wet.geojson");
      owet = await response.json();
      response = await fetch("assets/Pipe/ys_wet.geojson");
      yswet = await response.json();
      response = await fetch("assets/Pipe/tm_wet.geojson");
      tmwet = await response.json();
      response = await fetch("assets/Pipe/nw_wet.geojson");
      nwwet = await response.json();

      // // REFINARIES BY PIPELINE
      response = await fetch("assets/Pipe/refoil.geojson");
      orf = await response.json();
      response = await fetch("assets/Pipe/refoil.geojson");
      orf2 = await response.json();
      response = await fetch("assets/Pipe/ys_refine.geojson");
      ysrf = await response.json();
      response = await fetch("assets/Pipe/refoil.geojson");
      tmrf = await response.json();
      response = await fetch("assets/Pipe/refoil.geojson");
      tmrf2 = await response.json();
      response = await fetch("assets/Pipe/nw_com.geojson");
      nwrf = await response.json();

      //LOW INCOME
      response = await fetch("assets/Water/lowincome.geojson");
      income = await response.json();
      response = await fetch("assets/Pipe/o_tribe.geojson");
      o_tribe = await response.json();
      





      // 7. Trigger operations inside of the the ()=> {} funciton while loading the map.
      map.on('load', () => {

        // 8. add map source and declare layers.

        // ALL REFINARIES

        map.addSource('refine-src', {
          type: 'geojson',
          data: refine
        });

        // PIPELINES

        map.addSource('olympic-src', {
          type: 'geojson',
          data: olympic
        });

        map.addSource('olympic2-src', {
          type: 'geojson',
          data: olympic2
        });

        map.addSource('ys-src', {
          type: 'geojson',
          data: ys
        });

        map.addSource('ys2-src', {
          type: 'geojson',
          data: ys2
        });

        map.addSource('tm-src', {
          type: 'geojson',
          data: tm
        });

        map.addSource('tm2-src', {
          type: 'geojson',
          data: tm2
        });

        map.addSource('nw-src', {
          type: 'geojson',
          data: nw
        });

        map.addSource('nw2-src', {
          type: 'geojson',
          data: nw2
        });

        // WETLANDS

        map.addSource('owet-src', {
          type: 'geojson',
          data: olympic
        });

        map.addSource('yswet-src', {
          type: 'geojson',
          data: yswet
        });

        map.addSource('tmwet-src', {
          type: 'geojson',
          data: tmwet
        });

        map.addSource('nwwet-src', {
          type: 'geojson',
          data: nwwet
        });

        // REFINARIES BY PIPELINE

        map.addSource('orf-src', {
          type: 'geojson',
          data: orf
        });

        map.addSource('orf2-src', {
          type: 'geojson',
          data: orf2
        });

        map.addSource('ysrf-src', {
          type: 'geojson',
          data: ysrf
        });

        map.addSource('tmrf-src', {
          type: 'geojson',
          data: tmrf
        });

        map.addSource('tmrf2-src', {
          type: 'geojson',
          data: tmrf2
        });

        map.addSource('nwrf-src', {
          type: 'geojson',
          data: nwrf
        });

        //LOW INCOME
        map.addSource('income-src', {
          type: 'geojson',
          data: income
        });

        map.addSource('o_tribe-src', {
          type: 'geojson',
          data: o_tribe
        });







        //declare layers

        //ALL REFINARIES

        refineLayer = {
          'id': 'refine-points',
          'type': 'circle',
          'source': 'refine-src',
          'minzoom': 1,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 5,
            'circle-opacity': 0.4,
          }
        };

        // PIPELINES
        olympicLayer = {
          'id': 'olympic-lines',
          'type': 'line',
          'source': 'olympic-src',
          'minzoom': 5,
          'paint': {
            'line-color': '#000000',
            'line-width': 1.5
            
          }
        };

        olympic2Layer = {
          'id': 'olympic2-lines',
          'type': 'line',
          'source': 'olympic2-src',
          'minzoom': 5,
          'paint': {
            'line-color': '#000000',
            'line-width': 1.5
            
          }
        };

        ysLayer = {
          'id': 'ys-lines',
          'type': 'line',
          'source': 'ys-src',
          'minzoom': 5,
          'paint': {
            'line-color': '#000000',
            'line-width': 1.5
            
          }
        };

        ys2Layer = {
          'id': 'ys2-lines',
          'type': 'line',
          'source': 'ys2-src',
          'minzoom': 5,
          'paint': {
            'line-color': '#000000',
            'line-width': 1.5
            
          }
        };

        tmLayer = {
          'id': 'tm-lines',
          'type': 'line',
          'source': 'tm-src',
          'minzoom': 5,
          'paint': {
            'line-color': '#000000',
            'line-width': 1.5
          
          }
        };

        tm2Layer = {
          'id': 'tm2-lines',
          'type': 'line',
          'source': 'tm2-src',
          'minzoom': 5,
          'paint': {
            'line-color': '#000000',
            'line-width': 1.5
          
          }
        };

        nwLayer = {
          'id': 'nw-lines',
          'type': 'line',
          'source': 'nw-src',
          'minzoom': 5,
          'paint': {
            'line-color': '#000000',
            'line-width': 1.5
            
          }
        };

        nw2Layer = {
          'id': 'nw-lines',
          'type': 'line',
          'source': 'nw-src',
          'minzoom': 5,
          'paint': {
            'line-color': '#000000',
            'line-width': 1.5
            
          }
        };

        // WETLANDS
        owetLayer = {
          'id': 'owet-polygons',
          'type': 'fill',
          'source': 'owet-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#cc0000',
            'fill-opacity': 1

          }
        };

        yswetLayer = {
          'id': 'yswet-polygons',
          'type': 'fill',
          'source': 'yswet-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#cc0000',
            'fill-opacity': 1

          }
        };

        tmwetLayer = {
          'id': 'tmwet-polygons',
          'type': 'fill',
          'source': 'tmwet-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#cc0000',
            'fill-opacity': 1

          }
        };

        nwwetLayer = {
          'id': 'nwwet-polygons',
          'type': 'fill',
          'source': 'nwwet-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#cc0000',
            'fill-opacity': 1

          }
        };

        // REFINAREIS BY PIPELINE
        orfLayer = {
          'id': 'orf-points',
          'type': 'circle',
          'source': 'orf-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 5,
            'circle-opacity': 1,
          }
        };

        orf2Layer = {
          'id': 'orf2-points',
          'type': 'circle',
          'source': 'orf2-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 5,
            'circle-opacity': 1,
          }
        };

        ysrfLayer = {
          'id': 'ysrf-points',
          'type': 'circle',
          'source': 'ysrf-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 5,
            'circle-opacity': 1,
          }
        };

        tmrfLayer = {
          'id': 'tmrf-points',
          'type': 'circle',
          'source': 'tmrf-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 5,
            'circle-opacity': 1,
          }
        };

        tmrf2Layer = {
          'id': 'tmrf2-points',
          'type': 'circle',
          'source': 'tmrf2-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 5,
            'circle-opacity': 1,
          }
        };

        nwrfLayer = {
          'id': 'nwrf-points',
          'type': 'circle',
          'source': 'nwrf-src',
          'minzoom': 5,
          'paint': {
            'circle-color': '#cc0000',
            'circle-radius': 5,
            'circle-opacity': 1,
          }
        };

        //LOW INCOME 

        incomeLayer = {
          'id': 'income-polygons',
          'type': 'fill',
          'source': 'income-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#0000ff',
            'fill-opacity': 0.2

          }
        };

        o_tribeLayer = {
          'id': 'o_tribe-polygons',
          'type': 'fill',
          'source': 'o_tribe-src',
          'minzoom': 5,
          'paint': {
            'fill-color': '#00cc00',
            'fill-opacity': 0.2

          }
        };



        // 9. Initialize the script panel
        scriptPanel
          .setup({
            step: ".scene", // all the scenes.
            offset: 0.33, // the location of the enter and exit trigger
            debug: false // toggler on or off the debug mode.
          })
          .onStepEnter(handleSceneEnter)
          .onStepExit(handleSceneExit);
        
        // 10. This function performs when a scene enters the storyboard
        function handleSceneEnter(response) {

          var index = response.index; // capture the id of the current scene. 

          // Refinaries
          
          if (index === 0) { // When enter the first scene

            map.flyTo({
              center: [-124.6, 47.6131229],
              zoom: 6.2,
              pitch: 0,
              speed: 0.5
            }); // fly to a new location
            
            if (typeof (map.getSource('refine-src')) == 'undefined') { //if the map source 'counties-src' does not exist
              map.addSource('refine-src', {
                type: 'geojson',
                data: refine
              }); // reload the map source of 'counties-src'
            } else {
              map.getSource('refine-src').setData(refine); // if the map source does not exist, relaod the data counties to the pre-defined map source 'counties-src'.

            }

            if (!map.getLayer("refine-points")) { // if the map layer 'counties-polygons' does not exit
              map.addLayer(refineLayer);
            }
            document.getElementById("cover").style.visibility = "hidden"; // Hide the cover page
        

            // Ports
          } else if (index === 1) { // When enter the second scene.
            map.flyTo({
              center: [-124.6, 47.6131229],
              zoom: 6.2,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('olympic-src')) == 'undefined') {
              map.addSource('olympic-src', {
                type: 'geojson',
                data: olympic
              });
            } else {
              map.getSource('olympic-src').setData(olympic);

            }

            if (!map.getLayer("olympic-lines")) {
              map.addLayer(olympicLayer);
            }

            if (typeof (map.getSource('orf-src')) == 'undefined') {
              map.addSource('orf-src', {
                type: 'geojson',
                data: orf
              });
            } else {
              map.getSource('orf-src').setData(orf);

            }

            if (!map.getLayer("orf-points")) {
              map.addLayer(orfLayer);
            }

            
          } else if (index === 2) {
            //Relocate to Seattle
            map.flyTo({
              center: [-123, 46],
              zoom: 10,
              pitch: 70,
              speed: 0.5
            });

            if (typeof (map.getSource('olympic2-src')) == 'undefined') {
              map.addSource('olympic2-src', {
                type: 'geojson',
                data: olympic2
              });
            } else {
              map.getSource('olympic2-src').setData(olympic2);

            }

            if (!map.getLayer("olympic2-lines")) {
              map.addLayer(olympic2Layer);
            }

            if (typeof (map.getSource('owet-src')) == 'undefined') {
              map.addSource('owet-src', {
                type: 'geojson',
                data: owet
              });
            } else {
              map.getSource('owet-src').setData(owet);

            }

            if (!map.getLayer("owet-polygons")) {
              map.addLayer(owetLayer);
            }


          } else if (index === 3) { // When enter the second scene.
            map.flyTo({
              center: [-123, 48.7],
              zoom: 9,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('income-src')) == 'undefined') {
              map.addSource('income-src', {
                type: 'geojson',
                data: income
              });
            } else {
              map.getSource('income-src').setData(income);

            }

            if (!map.getLayer("income-polygons")) {
              map.addLayer(incomeLayer);
            }

            if (typeof (map.getSource('orf-src')) == 'undefined') {
              map.addSource('orf-src', {
                type: 'geojson',
                data: orf
              });
            } else {
              map.getSource('orf-src').setData(orf);

            }

            if (!map.getLayer("orf-points")) {
              map.addLayer(orfLayer);
            }

            
          } else if (index === 4) { // When enter the second scene.
            map.flyTo({
              center: [-123, 48.7],
              zoom: 9,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('o_tribe-src')) == 'undefined') {
              map.addSource('o_tribe-src', {
                type: 'geojson',
                data: o_tribe
              });
            } else {
              map.getSource('o_tribe-src').setData(o_tribe);

            }

            if (!map.getLayer("o_tribe-polygons")) {
              map.addLayer(o_tribeLayer);
            }

            if (typeof (map.getSource('orf2-src')) == 'undefined') {
              map.addSource('orf2-src', {
                type: 'geojson',
                data: orf
              });
            } else {
              map.getSource('orf2-src').setData(orf);

            }

            if (!map.getLayer("orf2-points")) {
              map.addLayer(orf2Layer);
            }

            
          } else if (index === 5) { // When enter the second scene.
            map.flyTo({
              center: [-123, 49],
              zoom: 8,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('tm-src')) == 'undefined') {
              map.addSource('tm-src', {
                type: 'geojson',
                data: tm
              });
            } else {
              map.getSource('tm-src').setData(tm);

            }

            if (!map.getLayer("tm-lines")) {
              map.addLayer(tmLayer);
            }

            if (typeof (map.getSource('tmrf-src')) == 'undefined') {
              map.addSource('tmrf-src', {
                type: 'geojson',
                data: tmrf
              });
            } else {
              map.getSource('tmrf-src').setData(tmrf);

            }

            if (!map.getLayer("tmrf-points")) {
              map.addLayer(tmrfLayer);
            }

            
          } else if (index === 6) { // When enter the second scene.
            map.flyTo({
              center: [-123, 48.7],
              zoom: 9,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('tm2-src')) == 'undefined') {
              map.addSource('tm2-src', {
                type: 'geojson',
                data: tm2
              });
            } else {
              map.getSource('tm2-src').setData(tm2);

            }

            if (!map.getLayer("tm2-lines")) {
              map.addLayer(tm2Layer);
            }

            if (typeof (map.getSource('tmwet-src')) == 'undefined') {
              map.addSource('tmwet-src', {
                type: 'geojson',
                data: tmwet
              });
            } else {
              map.getSource('tmwet-src').setData(tmwet);

            }

            if (!map.getLayer("tmwet-polygons")) {
              map.addLayer(tmwetLayer);
            }

            
          } else if (index === 7) { // When enter the second scene.
            map.flyTo({
              center: [-123, 48.7],
              zoom: 9,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('income-src')) == 'undefined') {
              map.addSource('income-src', {
                type: 'geojson',
                data: income
              });
            } else {
              map.getSource('income-src').setData(income);

            }

            if (!map.getLayer("income-polygons")) {
              map.addLayer(incomeLayer);
            }

            if (typeof (map.getSource('tmrf2-src')) == 'undefined') {
              map.addSource('tmrf2-src', {
                type: 'geojson',
                data: tmrf2
              });
            } else {
              map.getSource('tmrf2-src').setData(tmrf2);

            }

            if (!map.getLayer("tmrf2-points")) {
              map.addLayer(tmrf2Layer);
            }

            
          } else if (index === 8) { // When enter the second scene.
            map.flyTo({
              center: [-119.7, 47],
              zoom: 7,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('ys-src')) == 'undefined') {
              map.addSource('ys-src', {
                type: 'geojson',
                data: ys
              });
            } else {
              map.getSource('ys-src').setData(ys);

            }

            if (!map.getLayer("ys-lines")) {
              map.addLayer(ysLayer);
            }

            if (typeof (map.getSource('orf-src')) == 'undefined') {
              map.addSource('ysrf-src', {
                type: 'geojson',
                data: ysrf
              });
            } else {
              map.getSource('ysrf-src').setData(ysrf);

            }

            if (!map.getLayer("ysrf-points")) {
              map.addLayer(ysrfLayer);
            }

            
          } else if (index === 9) {
            //Relocate to Seattle
            map.flyTo({
              center: [-118, 47.5],
              zoom: 10,
              pitch: 70,
              speed: 0.5
            });

            if (typeof (map.getSource('ys2-src')) == 'undefined') {
              map.addSource('ys2-src', {
                type: 'geojson',
                data: ys2
              });
            } else {
              map.getSource('ys2-src').setData(ys2);

            }

            if (!map.getLayer("ys2-lines")) {
              map.addLayer(ys2Layer);
            }

            if (typeof (map.getSource('yswet-src')) == 'undefined') {
              map.addSource('yswet-src', {
                type: 'geojson',
                data: yswet
              });
            } else {
              map.getSource('yswet-src').setData(yswet);

            }

            if (!map.getLayer("yswet-polygons")) {
              map.addLayer(yswetLayer);
            }


          } else if (index === 10) {
            //Relocate to Seattle
            map.flyTo({
              center: [-119, 47],
              zoom: 7.7,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('income-src')) == 'undefined') {
              map.addSource('income-src', {
                type: 'geojson',
                data: income
              });
            } else {
              map.getSource('income-src').setData(income);

            }

            if (!map.getLayer("income-polygons")) {
              map.addLayer(incomeLayer);
            }

            if (typeof (map.getSource('ysrf-src')) == 'undefined') {
              map.addSource('ysrf-src', {
                type: 'geojson',
                data: ysrf
              });
            } else {
              map.getSource('ysrf-src').setData(ysrf);

            }

            if (!map.getLayer("ysrf-points")) {
              map.addLayer(ysrfLayer);
            }


          } else if (index === 11) { // When enter the second scene.
            map.flyTo({
              center: [-123, 46],
              zoom: 6.2,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('nw-src')) == 'undefined') {
              map.addSource('nw-src', {
                type: 'geojson',
                data: nw
              });
            } else {
              map.getSource('nw-src').setData(nw);

            }

            if (!map.getLayer("nw-lines")) {
              map.addLayer(nwLayer);
            }

            if (typeof (map.getSource('nwrf-src')) == 'undefined') {
              map.addSource('nwrf-src', {
                type: 'geojson',
                data: nwrf
              });
            } else {
              map.getSource('nwrf-src').setData(nwrf);

            }

            if (!map.getLayer("nwrf-points")) {
              map.addLayer(nwrfLayer);
            }

            
          } else if (index === 12) { // When enter the second scene.
            map.flyTo({
              center: [-123, 46],
              zoom: 6.2,
              pitch: 0,
              speed: 0.5
            });

            if (typeof (map.getSource('nw2-src')) == 'undefined') {
              map.addSource('nw2-src', {
                type: 'geojson',
                data: nw2
              });
            } else {
              map.getSource('nw2-src').setData(nw2);

            }

            if (!map.getLayer("nw2-lines")) {
              map.addLayer(nw2Layer);
            }

            if (typeof (map.getSource('nwwet-src')) == 'undefined') {
              map.addSource('nwet-src', {
                type: 'geojson',
                data: nwwet
              });
            } else {
              map.getSource('nwwet-src').setData(nwwet);

            }

            if (!map.getLayer("nwwet-polygons")) {
              map.addLayer(nwwetLayer);
            }

            
          } else if (index === 14) {

            map.flyTo({
              center: [-122.4121036, 47.6131229],
              zoom: 7,
              pitch: 0,
              speed: 0.5

            });


          }



        }

        

        // 11. This function performs when a scene exists the storyboard
        function handleSceneExit(response) {
          var index = response.index;

          if (index === 0) {
            if (map.getLayer("refine-points")) {
              map.removeLayer('refine-points');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 1) {
            if (map.getLayer("olympic-lines")) {
              map.removeLayer('olympic-lines');
            }
            if (map.getLayer("orf-points")) {
              map.removeLayer('orf-points');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 2) {
            if (map.getLayer("olympic2-lines")) {
              map.removeLayer('olympic2-lines');
            }
            if (map.getLayer("owet-polygons")) {
              map.removeLayer('owet-polygons');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 
 
          } else if (index === 3) {
            if (map.getLayer("orf-points")) {
              map.removeLayer('orf-points');
            }
            if (map.getLayer("income-polygons")) {
              map.removeLayer('income-polygons');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 4) {
            if (map.getLayer("orf2-points")) {
              map.removeLayer('orf2-points');
            }
            if (map.getLayer("o_tribe-polygons")) {
              map.removeLayer('o_tribe-polygons');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 5) {
            if (map.getLayer("tm-lines")) {
              map.removeLayer('tm-lines');
            }
            if (map.getLayer("tmrf-points")) {
              map.removeLayer('tmrf-points');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 6) {
            if (map.getLayer("tm2-lines")) {
              map.removeLayer('tm2-lines');
            }
            if (map.getLayer("tmwet-polygons")) {
              map.removeLayer('tmwet-polygons');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 7) {
            if (map.getLayer("tmrf2-points")) {
              map.removeLayer('tmrf2-points');
            }
            if (map.getLayer("income-polygons")) {
              map.removeLayer('income-polygons');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          }else if (index === 8) {
            if (map.getLayer("ys-lines")) {
              map.removeLayer('ys-lines');
            }
            if (map.getLayer("ysrf-points")) {
              map.removeLayer('ysrf-points');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 9) {
            if (map.getLayer("ys2-lines")) {
              map.removeLayer('ys2-lines');
            }
            if (map.getLayer("yswet-polygons")) {
              map.removeLayer('yswet-polygons');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 10) {
            if (map.getLayer("ysrf-points")) {
              map.removeLayer('ysrf-points');
            }
            if (map.getLayer("income-polygons")) {
              map.removeLayer('income-polygons');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 11) {
            if (map.getLayer("nw-lines")) {
              map.removeLayer('nw-lines');
            }
            if (map.getLayer("nwrf-points")) {
              map.removeLayer('nwrf-points');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          } else if (index === 12) {
            if (map.getLayer("nw2-lines")) {
              map.removeLayer('nw2-lines');
            }
            if (map.getLayer("nwwet-polygons")) {
              map.removeLayer('nwwet-polygons');
            }

            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            } 

          }
        
        }
        });

    };
    // Define a popup variable for tribal and wetland data
    
    let refinePopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });
    
    let vspillPopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    let portsPopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    let ports2Popup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    let trafficPopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    let full_tribalPopup = new mapboxgl.Popup({
      closeButton: true,
      closeOnClick: true
    });

    

    // SPILLS
    map.on('click', 'vspill-points', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>${feature.properties.CaseName}</h3>
                          <p>Date: ${feature.properties.Date_incid}</p>
                          <p>Vessel Type: ${feature.properties.Source}</p>
                          <p>Oil Type: ${feature.properties.Oil_type}</p>`;
      vspillPopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'vspill-points', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'vspill-points', function() {
      map.getCanvas().style.cursor = '';
    });

    // REFINARIES
    map.on('click', 'refine-points', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>${feature.properties.FacilityNa}</h3>
                          <p>Oil Type: ${feature.properties.OilProduct}</p>`;
      refinePopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'refine-points', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'refine-points', function() {
      map.getCanvas().style.cursor = '';
    });


    // Ports
    map.on('click', 'ports-points', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>${feature.properties.NAME}</h3>
                          <p>Oil Type: ${feature.properties.TYPE}</p>`;
      portsPopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'ports-points', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'ports-points', function() {
      map.getCanvas().style.cursor = '';
    });

    map.on('click', 'ports2-points', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>${feature.properties.NAME}</h3>
                          <p>Oil Type: ${feature.properties.TYPE}</p>`;
      ports2Popup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'ports2-points', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'ports2-points', function() {
      map.getCanvas().style.cursor = '';
    });


    // Traffic
    map.on('click', 'traffic-polygons', function(e) {
      let feature = e.features[0];
      let popupContent = `<h3>2020 Vessel Traffic</h3>`;

      trafficPopup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
    });

    map.on('mouseenter', 'traffic-polygons', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'traffic-polygons', function() {
      map.getCanvas().style.cursor = '';
    });





    const nav = new mapboxgl.NavigationControl();
    map.addControl(nav, 'top-right');





    // 5 call the data loading function.
    geojsonFetch();
  </script>
</body>


</html>

  